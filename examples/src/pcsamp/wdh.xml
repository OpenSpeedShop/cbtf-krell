<?xml version="1.0" encoding="utf-8"?>

<!--
Copyright (c) 2011 Krell Institute. All Rights Reserved.
    
This library is free software; you can redistribute it and/or modify it under
the terms of the GNU Lesser General Public License as published by the Free
Software Foundation; either version 2.1 of the License, or (at your option)
any later version.
    
This library is distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more
details.
    
You should have received a copy of the GNU Lesser General Public License
along with this library; if not, write to the Free Software Foundation, Inc.,
59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-->

<MRNet xmlns="http://www.krellinst.org/CBTF/MRNet.xsd">

  <Type>PC_Sampling_Demo</Type>
  <Version>0.0.0</Version>

  <Stream>
    <Name>CBTF_PROTOCOL_TAG_PERFORMANCE_DATA</Name>
    <Tag>10000</Tag>
  </Stream>

  <Frontend>

    <Network>
      <Type>PC_Sampling_Demo_Frontend</Type>
      <Version>0.0.0</Version>
      <SearchPath>.</SearchPath>
      <Plugin>pcsampDemoPlugin</Plugin>

      <Component>
        <Name>PacketToAddressBuffer</Name>
        <!-- You need to create the following component type! -->
        <Type>ConvertPacketToAddressBuffer</Name>
      </Component>
      
      <Component>
        <Name>Display</Name>
        <!-- You need to create the following component type! -->
        <Type>DisplayAddressBuffer</Type>
      </Component>

      <Connection>
        <From>
          <Name>PacketToAddressBuffer</Name>
          <Output>out</Output>
        </From>
        <To>
          <Name>Display</Name>
          <Input>in</Input>
        </To>
      </Connection>
      
      <Input>
        <Name>IncomingBuffers</Name>
        <To>
          <Name>PacketToAddressBuffer</Name>
          <Input>in</Input>
        </To>
      </Input>

    </Network>

    <IncomingUpstream>
      <Name>Buffers</Name>
      <To><Input>IncomingBuffers</Input></To>
    </IncomingUpstream>
    
  </Frontend>

  <Filter>
    
    <Depth><AllOther/></Depth>
    
    <Network>
      <Type>PC_Sampling_Demo_Filter</Type>
      <Version>0.0.0</Version>
      <SearchPath>.</SearchPath>
      <SearchPath>/opt/cbtf-dev/lib64</SearchPath>
      <Plugin>pcsampDemoPlugin</Plugin>
      <Plugin>libcbtf-messages-converters.base.so</Plugin>
      
      <Component>
        <Name>PacketToBlob</Name>
        <Type>KrellInstitute::CBTF::ConvertMRNetToXDR&lt;CBTF_Protocol_Blob&gt;</Type>
      </Component>
      
      <Component>
        <Name>PacketToAddressBuffer</Name>
        <!-- You need to create the following component type! -->
        <Type>ConvertPacketToAddressBuffer</Name>
      </Component>
      
      <Component>
        <Name>Aggregator</Name>
        <Type>AddressAggregator</Type>
      </Component>
      
      <Component>
        <Name>AddressBufferToPacket</Name>
        <!-- You need to create the following component type! -->
        <Type>ConvertAddressBufferToPacket</Type>
      </Component>
      
      <Connection>
        <From>
          <Name>PacketToBlob</Name>
          <Output>out</Output>
        </From>
        <To>
          <Name>Aggregator</Name>
          <Input>in4</Input>
        </To>
      </Connection>
      
      <Connection>
        <From>
          <Name>PacketToAddressBuffer</Name>
          <Output>out</Output>
        </From>
        <To>
          <Name>Aggregator</Name>
          <Input>in2</Input>
        </To>
      </Connection>
      
      <Connection>
        <From>
          <Name>Aggregator</Name>
          <Output>Aggregatorout</Output>
        </From>
        <To>
          <Name>AddressBuffertoPacket</Name>
          <Input>in</Input>
        </To>
      </Connection>
      
      <Input>
        <Name>IncomingBlobs</Name>
        <To>
          <Name>PacketToBlob</Name>
          <Input>in</Input>
        </To>
      </Input>
      
      <Input>
        <Name>IncomingBuffers</Name>
        <To>
          <Name>PacketToAddressBuffer</Name>
          <Input>in</Input>
        </To>
      </Input>
      
      <Output>
        <Name>OutgoingBuffers</Name>
        <From>
          <Name>AddressBufferToPacket</Name>
          <Output>out</Output>
        </From>
      </Output>
      
    </Network>    
    
    <IncomingUpstream>
      <Name>CBTF_PROTOCOL_TAG_PERFORMANCE_DATA</Name>
      <To><Input>IncomingBlobs</Input></To>
    </IncomingUpstream>
    
    <IncomingUpstream>
      <Name>Buffers</Name>
      <To><Input>IncomingBuffers</Input></To>
    </IncomingUpstream>
    
    <OutgoingUpstream>
      <Name>Buffers</Name>
      <From><Output>OutgoingBuffers</Output></From>
    </OutgoingUpstream>
    
  </Filter>
  
</MRNet>
